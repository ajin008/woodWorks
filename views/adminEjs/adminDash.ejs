<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashtreme Admin - Free Dashboard for Bootstrap 4 by Codervent</title>
    <!-- loader-->
    <link href="../assets/css/pace.min.css" rel="stylesheet" />
    <script src="../assets/js/pace.min.js"></script>
    <!--favicon-->
    <link rel="icon" href="../assets/images/favicon.ico" type="image/x-icon" />
    <!-- Vector CSS -->
    <link
      href="../assets/plugins/vectormap/jquery-jvectormap-2.0.2.css"
      rel="stylesheet"
    />
    <!-- simplebar CSS-->
    <link
      href="../assets/plugins/simplebar/css/simplebar.css"
      rel="stylesheet"
    />
    <!-- Bootstrap core CSS-->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <!-- animate CSS-->
    <link href="../assets/css/animate.css" rel="stylesheet" type="text/css" />
    <!-- Icons CSS-->
    <link href="../assets/css/icons.css" rel="stylesheet" type="text/css" />
    <!-- Sidebar CSS-->
    <link href="../assets/css/sidebar-menu.css" rel="stylesheet" />
    <!-- Custom Style-->
    <link href="../assets/css/app-style.css" rel="stylesheet" />

    
  </head>

  <body class="bg-theme bg-theme1">
    <!-- Start wrapper-->
    <div id="wrapper">
      <!--Start sidebar-wrapper-->
      <div
        id="sidebar-wrapper"
        data-simplebar=""
        data-simplebar-auto-hide="true"
      >
        <div class="brand-logo">
          <a href="index.html">
            <img
              src="../assets/images/logo-icon.png"
              class="logo-icon"
              alt="logo icon"
            />
            <h5 class="logo-text">WoodWorks Admin</h5>
          </a>
        </div>
        <ul class="sidebar-menu do-nicescrol">
          <li class="sidebar-header">MAIN NAVIGATION</li>
          <li class="active">
            <a href="/adminDash">
              <i class="zmdi zmdi-view-dashboard"></i> <span>Dashboard</span>
            </a>
          </li>

          <li>
            <a href="userManagement">
              <i class="zmdi zmdi-invert-colors"></i>
              <span>userManagement</span>
            </a>
          </li>

          <li>
            <a href="/productManagement">
              <i class="zmdi zmdi-format-list-bulleted"></i>
              <span>productManagement</span>
            </a>
          </li>

          <li>
            <a href="/categoryManagement">
              <i class="zmdi zmdi-grid"></i> <span>categoryManagement</span>
            </a>
          </li>
          <li>
            <a href="/OderManagement">
              <i class="zmdi zmdi-grid"></i> <span>OderManagement</span>
            </a>
          </li>
          <li>
            <a href="/inventory">
              <i class="zmdi zmdi-grid"></i> <span>Inventory</span>
            </a>
          </li>
          <li>
            <a href="/couponManagement">
              <i class="zmdi zmdi-grid"></i> <span>coupon Management</span>
            </a>
          </li>
          <li>
            <a href="/ReturnedOrder">
              <i class="zmdi zmdi-grid"></i> <span>ReturnedOrder</span>
            </a>
          </li>
          <li>
            <a href="/couponManagement">
              <i class="zmdi zmdi-grid"></i> <span>coupon Management</span>
            </a>
          </li>
          <li>
            <a href="/salesReport">
              <i class="zmdi zmdi-grid"></i> <span>SalesReport</span>
            </a>
          </li>
          <li>
            <a href="/offerManagement">
              <i class="zmdi zmdi-grid"></i> <span>offerManagement</span>
            </a>
          </li>
        </ul>
      </div>
      <!--End sidebar-wrapper-->

      <!--Start topbar header-->
      <header class="topbar-nav">
        <nav class="navbar navbar-expand fixed-top">
          <ul class="navbar-nav mr-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link toggle-menu" href="javascript:void();">
                <i class="icon-menu menu-icon"></i>
              </a>
            </li>
            <li class="nav-item">
              <form class="search-bar">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Enter keywords"
                />
                <a href="javascript:void();"><i class="icon-magnifier"></i></a>
              </form>
            </li>
          </ul>
          <form id="logoutForm" action="/adminLogout" method="POST">
            <button
              type="submit"
              class="nav-link btn btn-warning"
              id="logoutBtn"
            >
              <i class="/logout"></i> Logout
            </button>
          </form>
        </nav>
      </header>
      <!--End topbar header-->

      <!-- user and product list  -->
      <div class="content-wrapper">
        <div class="container-fluid">
          <div class="card mt-3">
            <div class="card-content">
              <div class="row row-group m-0">
                <!-- Total Users -->
                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <!-- Display the total number of users dynamically -->
                      <%= totalUsersCount %> Total Users
                      <span class="float-right">
                        <!-- Icon for users -->
                        <i class="fa fa-users"></i>
                      </span>
                    </h5>
                    <!-- Progress bar (optional) -->
                    <div class="progress my-3" style="height: 3px">
                      <div class="progress-bar" style="width: 55%"></div>
                    </div>
                    <!-- Additional information (optional) -->
                    <p class="mb-0 text-white small-font">
                      Total Users
                      <!-- Additional stats (optional) -->
                      <span class="float-right"
                        >+4.2% <i class="zmdi zmdi-long-arrow-up"></i
                      ></span>
                    </p>
                  </div>
                </div>
                <!-- Total Products -->
                <div class="col-12 col-lg-6 col-xl-3 border-light">  
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <!-- Display the total number of products dynamically -->
                      <%= totalProductsCount %> Total Products
                      <span class="float-right">
                        <!-- Icon for products -->
                        <i class="fa fa-cubes"></i>
                      </span>
                    </h5>
                    <!-- Progress bar (optional) -->
                    <div class="progress my-3" style="height: 3px">
                      <div class="progress-bar" style="width: 55%"></div>
                    </div>
                    <!-- Additional information (optional) -->
                    <p class="mb-0 text-white small-font">
                      Total Products
                      <!-- Additional stats (optional) -->
                      <span class="float-right"
                        >+1.2% <i class="zmdi zmdi-long-arrow-up"></i
                      ></span>
                    </p>
                  </div>
                </div>
                <!-- total orders -->
                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <!-- Display the total number of orders dynamically -->
                      <%= totalOrdersCount %> Total Orders
                      <span class="float-right">
                        <!-- Icon for orders -->
                        <i class="fa fa-shopping-cart"></i>
                      </span>
                    </h5>
                    <!-- Progress bar (optional) -->
                    <div class="progress my-3" style="height: 3px">
                      <div class="progress-bar" style="width: 55%"></div>
                    </div>
                    <!-- Additional information (optional) -->
                    <p class="mb-0 text-white small-font">
                      Total Orders
                      <!-- Additional stats (optional) -->
                      <span class="float-right"
                        >+3.5% <i class="zmdi zmdi-long-arrow-up"></i
                      ></span>
                    </p>
                  </div>
                </div>

                <div class="col-12 col-lg-6 col-xl-3 border-light">
                  <div class="card-body">
                    <h5 class="text-white mb-0">
                      <!-- Display the total sales dynamically -->
                      <%= totalSales %> Total Sales
                      <span class="float-right">
                        <!-- Icon for sales -->
                        <i class="fa fa-money"></i>
                      </span>
                    </h5>
                    <!-- Progress bar (optional) -->
                    <div class="progress my-3" style="height: 3px">
                      <div class="progress-bar" style="width: 55%"></div>
                    </div>
                    <!-- Additional information (optional) -->
                    <p class="mb-0 text-white small-font">
                      Total Sales
                      <!-- Additional stats (optional) -->
                      <span class="float-right"
                        >+2.8% <i class="zmdi zmdi-long-arrow-up"></i
                      ></span>
                    </p>
                  </div>
                </div>
                <!-- Add more similar cards for other metrics (if needed) -->
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-12">
              <div class="card">
                <div class="card-body">
                  <div class="m-4">
                    <form id="dateRangeForm">
                      <label for="startDate">Start Date:</label>
                      <input type="date" id="startDate" name="startDate" />

                      <label for="endDate">End Date:</label>
                      <input type="date" id="endDate" name="endDate" />

                      <button class="btn btn-light" type="submit">
                        Apply Filter
                      </button>
                    </form>
                  </div>

                  <div class="d-flex justify-content-between">
                    <h2>SalesReport</h2>
                  </div>
                  <div class="table-responsive">
                    <table class="table table-striped">
                      <thead>
                        <tr>
                          <th>ProductName</th>
                          <th>price</th>
                          <th>Payment</th>
                          <th>delivered Date</th>
                          <th>status</th>
                          <th>qty</th>
                          <th>discount</th>
                          <th>coupon deduction</th>
                          <th>action</th>
                        </tr>
                      </thead>
                      <tbody id="salesReportTableBody">
                        <% orders.reverse().forEach(order => { %>
                        <tr>
                          <td><%= order.productName %></td>
                          <td><%= order.discountedPrice %></td>
                          <td><%= order.payment %></td>
                          <td>
                            <% if (order.status === 'pending' ||
                            !order.deliveryDateTime) { %> Pending <% } else { %>
                            <%= new
                            Date(order.deliveryDateTime).toLocaleString('en-US',
                            { timeZone: 'UTC' }) %> <% } %>
                          </td>
                          <td><%= order.status %></td>
                          <td><%= order.quantity %></td>
                          <td><%= order.discountType %></td>
                          <td><%= order.couponDiscount %></td>
                          <td>
                            <button
                              class="btn btn-warning"
                              onclick="redirectToViewOrders('<%= order._id %>')"
                            >
                              View details
                            </button>
                          </td>
                        </tr>
                        <% }); %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-12 col-lg-8 col-xl-8">
             <div class="card">
            <div class="card-header">Over all Sales
              <div class="card-action">
              <div class="dropdown">
              
               
               </div>
              </div>
            </div>
            <div class="card-body">
               <ul class="list-inline">
               <li class="list-inline-item"><i class="fa fa-circle mr-2 text-white"></i>Sales</li>
               <li class="list-inline-item"><i class="fa fa-circle mr-2 text-light"></i>Order</li>
             </ul>
             <canvas id="ordersChart"></canvas>
            </div>
            
            <div class="row m-0 row-group text-center border-top border-light-3">
              <div class="col-12 col-lg-4">
                <div class="p-3">
                  <h5 class="mb-0"><%= totalUsersCount %> </h5>
                <small class="mb-0">Overall  Total Users <span> <i class="fa fa-arrow-up"></i> 6.43%</span></small>
                </div>
              </div>
              <div class="col-12 col-lg-4">
                <div class="p-3">
                  <h5 class="mb-0"><%= totalProductsCount %> </h5>
                <small class="mb-0">  Total Products <span> <i class="fa fa-arrow-up"></i> 12.65%</span></small>
                </div>
              </div>
              <div class="col-12 col-lg-4">
                <div class="p-3">
                  <h5 class="mb-0"><%= totalOrdersCount %></h5>
                <small class="mb-0"> Orders <span> <i class="fa fa-arrow-up"></i> 1.62%</span></small>
                </div>
              </div>
            </div>
            
           </div>
          </div>
       
            <div class="col-12 col-lg-4 col-xl-4">
               <div class="card">
                  <div class="card-header">Performance outlook
                    <div class="card-action">
                    <div class="dropdown">
                    <a href="javascript:void();" class="dropdown-toggle dropdown-toggle-nocaret" data-toggle="dropdown">
                     <i class="icon-options"></i>
                    </a>
                     <div class="dropdown-menu dropdown-menu-right">
                     <a class="dropdown-item" href="javascript:void();">Action</a>
                     <a class="dropdown-item" href="javascript:void();">Another action</a>
                     <a class="dropdown-item" href="javascript:void();">Something else here</a>
                     <div class="dropdown-divider"></div>
                     <a class="dropdown-item" href="javascript:void();">Separated link</a>
                      </div>
                     </div>
                    </div>
                  </div>
                  <div class="card-body">
                <div class="chart-container-2">
                      <canvas id="chart2"></canvas>
               </div>
                  </div>
                  <div class="table-responsive">
                    <table class="table align-items-center">
                      <tbody>
                        <tr>
                          <td><i class="fa fa-circle text-white mr-2"></i> Best selling product</td>
                          
                          <% if (bestSellingProduct.length > 0) { %>
                            <td><%= bestSellingProduct[0]._id %></td>
                            <td><%= bestSellingProduct[0].totalOrders %></td>
                          <% } else { %>
                            <p>No best selling product found.</p>
                          <% } %>
                          
                        </tr>
                        <tr>
                          <td><i class="fa fa-circle text-light-1 mr-2"></i>Best selling category</td>
                          <% if (bestSellingCategory.length > 0) { %>
                            <td><%= bestSellingCategory[0].categoryName %></td>
                            <td><%= bestSellingCategory[0].totalOrders %></td>
                          <% } else { %>
                            <p>No best selling category found.</p>
                          <% } %>
                          
                        </tr>
                        <tr>
                          <td><i class="fa fa-circle text-light-2 mr-2"></i>Best selling brand</td>
                          <% if (bestSellingBrand.length > 0) { %>
                            <td><%= bestSellingBrand[0]._id %></td>
                            <td><%= bestSellingBrand[0].totalOrders %></td>
                          <% } else { %>
                            <p>No best selling brand found.</p>
                          <% } %>
                          
                        </tr>
                        
                      </tbody>
                    </table>
                  </div>
                </div>
            </div>
         </div><!--End Row-->

      

      <!-- user and product list end -->

      <!--End content-wrapper-->
      <!--Start Back To Top Button-->
      <a href="javaScript:void();" class="back-to-top"
        ><i class="fa fa-angle-double-up"></i>
      </a>
      <!--End Back To Top Button-->

      <!--Start footer-->
      <footer class="footer">
        <div class="container">
          <div class="text-center">Copyright © 2024 WoodWorks Admin</div>
        </div>
      </footer>
      <!--End footer-->

      <!--start color switcher-->
      <div class="right-sidebar">
        <div class="switcher-icon">
          <i class="zmdi zmdi-settings zmdi-hc-spin"></i>
        </div>
        <div class="right-sidebar-content">
          <p class="mb-0">Gaussion Texture</p>
          <hr />

          <ul class="switcher">
            <li id="theme1"></li>
            <li id="theme2"></li>
            <li id="theme3"></li>
            <li id="theme4"></li>
            <li id="theme5"></li>
            <li id="theme6"></li>
          </ul>

          <p class="mb-0">Gradient Background</p>
          <hr />

          <ul class="switcher">
            <li id="theme7"></li>
            <li id="theme8"></li>
            <li id="theme9"></li>
            <li id="theme10"></li>
            <li id="theme11"></li>
            <li id="theme12"></li>
            <li id="theme13"></li>
            <li id="theme14"></li>
            <li id="theme15"></li>
          </ul>
        </div>
      </div>
      <!--end color switcher-->
    </div>
    <!--End wrapper-->

    <!-- Bootstrap core JavaScript-->
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/popper.min.js"></script>
    <script src="../assets/js/bootstrap.min.js"></script>

    <!-- simplebar js -->
    <script src="../assets/plugins/simplebar/js/simplebar.js"></script>
    <!-- sidebar-menu js -->
    <script src="../assets/js/sidebar-menu.js"></script>
    <!-- loader scripts -->
    <script src="../assets/js/jquery.loading-indicator.js"></script>
    <!-- Custom scripts -->
    <script src="../assets/js/app-script.js"></script>
    <!-- Chart js -->

    <script src="../assets/plugins/Chart.js/Chart.min.js"></script>

    <!-- Index js -->
    <script src="../assets/js/index.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document
          .getElementById("dateRangeForm")
          .addEventListener("submit", function (event) {
            event.preventDefault();

            const startDate = document.getElementById("startDate").value;
            const endDate = document.getElementById("endDate").value;

            fetch(
              `/api/filterSalesReport?startDate=${startDate}&endDate=${endDate}`
            )
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Network response was not ok");
                }
                return response.json();
              })
              .then((data) => {
                if (data && data.length > 0) {
                  const rows = data
                    .map(
                      (order) => `
                              <tr>
                                  <td>${order.productName}</td>
                                  <td>${order.discountedPrice}</td>
                                  <td>${order.payment}</td>
                                  <td>${new Date(
                                    order.deliveryDateTime
                                  ).toLocaleString("en-US", {
                                    timeZone: "UTC",
                                  })}</td>
                                  <td>${order.status}</td>
                                  <td>${order.quantity}</td>
                                  <td>${order.discountType}</td>
                                  <td>${order.couponDiscount}</td>
                                  <td>
                                      <button class="btn btn-warning" onclick="redirectToViewOrders('${
                                        order._id
                                      }')">
                                          View details
                                      </button>
                                  </td>
                              </tr>
                          `
                    )
                    .join("");

                  document.getElementById("salesReportTableBody").innerHTML =
                    rows;
                } else {
                  document.getElementById("salesReportTableBody").innerHTML =
                    "<tr><td colspan='9'>No data available</td></tr>";
                }
              })
              .catch((error) => {
                console.error("Error:", error);
              });
          });
      });

      document.addEventListener("DOMContentLoaded", function () {
    fetch('/admin/dashboard/ordersData')
      .then(response => response.json())
      .then(data => {
        // Call a function to render the chart using the data
        renderChart(data);
      })
      .catch(error => console.error('Error fetching orders data:', error));
  });

  function renderChart(data) {
    // Use Chart.js to render the chart using the fetched data
    // Example:
    const ctx = document.getElementById('ordersChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Today', 'Yesterday', 'Last 7 days', 'Last 30 days'],
        datasets: [{
          label: 'Number of Orders',
          data: data,
          backgroundColor: [ // Customize background color for each bar
            'rgb(0, 255, 157)', // Today
            'rgba(233, 121, 56, 1)', // Yesterday
            'rgb(194, 255, 89)', // Last 7 days
            'rgb(13, 182, 255)' // Last 30 days
          ],
          borderColor: [ // Customize border color for each bar
            'rgb(0, 255, 157)',
            'rgba(233, 121, 56, 1)',
            'rgb(194, 255, 89)',
            'rgb(13, 182, 255)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

      function redirectToViewOrders(orderId) {
        window.location.href = "/viewOrder/" + orderId;
      }

      
    </script>
  </body>
</html>
